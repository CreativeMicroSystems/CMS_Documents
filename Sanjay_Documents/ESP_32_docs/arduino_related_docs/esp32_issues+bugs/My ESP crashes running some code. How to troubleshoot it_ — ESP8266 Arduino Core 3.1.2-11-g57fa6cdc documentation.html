<!DOCTYPE html>
<!-- saved from url=(0076)https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html -->
<html class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg smil svgclippaths" lang="en" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>My ESP crashes running some code. How to troubleshoot it? — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" async="" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/analytics.js.download"></script><script type="text/javascript" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/modernizr.min.js.download"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/documentation_options.js.download"></script>
        <script data-url_root="../" id="documentation_options" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/documentation_options.js.download"></script>
        <script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/jquery.js.download"></script>
        <script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/underscore.js.download"></script>
        <script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/_sphinx_javascript_frameworks_compat.js.download"></script>
        <script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/doctools.js.download"></script>
        <script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/sphinx_highlight.js.download"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/require.min.js.download"></script>
        <script async="async" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/readthedocs-doc-embed.js.download"></script>
    
    <script type="text/javascript" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/theme.js.download"></script>

    

  
  <link rel="stylesheet" href="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/theme.css" type="text/css">
  <link rel="stylesheet" href="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/pygments.css" type="text/css">
  <link rel="stylesheet" href="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/pygments.css" type="text/css">
  <link rel="stylesheet" href="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/theme.css" type="text/css">
    <link rel="index" title="Index" href="https://arduino-esp8266.readthedocs.io/en/latest/genindex.html">
    <link rel="search" title="Search" href="https://arduino-esp8266.readthedocs.io/en/latest/search.html"> 

<!-- RTD Extra Head -->

<link rel="stylesheet" href="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/readthedocs-doc-embed.css" type="text/css">

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2023-04-30T23:06:49Z", "builder": "sphinx", "canonical_url": null, "commit": "57fa6cdc", "docroot": "/doc/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "faq/a02-my-esp-crashes", "programming_language": "cpp", "project": "arduino-esp8266", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/readthedocs-analytics.js.download" async="async"></script>

<!-- end RTD <extrahead> -->
<script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/ethicalads.min.js.download" type="text/javascript" async="" id="ethicaladsjs"></script><script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/js" type="text/javascript" async=""></script><style>[data-ea-publisher].loaded,[data-ea-type].loaded{font-size:14px;font-family:-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;font-weight:normal;font-style:normal;leter-spacing:0px;vertical-align:baseline;line-height:1.3em}[data-ea-publisher].loaded a,[data-ea-type].loaded a{text-decoration:none}[data-ea-publisher].loaded .ea-pixel,[data-ea-type].loaded .ea-pixel{display:none}[data-ea-publisher].loaded .ea-content,[data-ea-type].loaded .ea-content{margin:1em 1em 0.5em 1em;padding:1em;background:rgba(0,0,0,0.03);color:#505050}[data-ea-publisher].loaded .ea-content a:link,[data-ea-type].loaded .ea-content a:link{color:#505050}[data-ea-publisher].loaded .ea-content a:visited,[data-ea-type].loaded .ea-content a:visited{color:#505050}[data-ea-publisher].loaded .ea-content a:hover,[data-ea-type].loaded .ea-content a:hover{color:#373737}[data-ea-publisher].loaded .ea-content a:active,[data-ea-type].loaded .ea-content a:active{color:#373737}[data-ea-publisher].loaded .ea-content a strong,[data-ea-publisher].loaded .ea-content a b,[data-ea-type].loaded .ea-content a strong,[data-ea-type].loaded .ea-content a b{color:#088cdb}[data-ea-publisher].loaded .ea-callout a:link,[data-ea-type].loaded .ea-callout a:link{color:#6a6a6a}[data-ea-publisher].loaded .ea-callout a:visited,[data-ea-type].loaded .ea-callout a:visited{color:#6a6a6a}[data-ea-publisher].loaded .ea-callout a:hover,[data-ea-type].loaded .ea-callout a:hover{color:#505050}[data-ea-publisher].loaded .ea-callout a:active,[data-ea-type].loaded .ea-callout a:active{color:#505050}[data-ea-publisher].loaded .ea-callout a strong,[data-ea-publisher].loaded .ea-callout a b,[data-ea-type].loaded .ea-callout a strong,[data-ea-type].loaded .ea-callout a b{color:#088cdb}[data-ea-publisher].loaded .ea-callout a,[data-ea-type].loaded .ea-callout a{font-size:0.8em}[data-ea-publisher].loaded.dark .ea-content,[data-ea-type].loaded.dark .ea-content{background:rgba(255,255,255,0.05);color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-content a:link,[data-ea-type].loaded.dark .ea-content a:link{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-content a:visited,[data-ea-type].loaded.dark .ea-content a:visited{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-content a:hover,[data-ea-type].loaded.dark .ea-content a:hover{color:#f6f6f6}[data-ea-publisher].loaded.dark .ea-content a:active,[data-ea-type].loaded.dark .ea-content a:active{color:#f6f6f6}[data-ea-publisher].loaded.dark .ea-content a strong,[data-ea-publisher].loaded.dark .ea-content a b,[data-ea-type].loaded.dark .ea-content a strong,[data-ea-type].loaded.dark .ea-content a b{color:#50baf9}[data-ea-publisher].loaded.dark .ea-callout a:link,[data-ea-type].loaded.dark .ea-callout a:link{color:#c3c3c3}[data-ea-publisher].loaded.dark .ea-callout a:visited,[data-ea-type].loaded.dark .ea-callout a:visited{color:#c3c3c3}[data-ea-publisher].loaded.dark .ea-callout a:hover,[data-ea-type].loaded.dark .ea-callout a:hover{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-callout a:active,[data-ea-type].loaded.dark .ea-callout a:active{color:#dcdcdc}[data-ea-publisher].loaded.dark .ea-callout a strong,[data-ea-publisher].loaded.dark .ea-callout a b,[data-ea-type].loaded.dark .ea-callout a strong,[data-ea-type].loaded.dark .ea-callout a b{color:#50baf9}@media (prefers-color-scheme: dark){[data-ea-publisher].loaded.adaptive .ea-content,[data-ea-type].loaded.adaptive .ea-content{background:rgba(255,255,255,0.05);color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-content a:link,[data-ea-type].loaded.adaptive .ea-content a:link{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-content a:visited,[data-ea-type].loaded.adaptive .ea-content a:visited{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-content a:hover,[data-ea-type].loaded.adaptive .ea-content a:hover{color:#f6f6f6}[data-ea-publisher].loaded.adaptive .ea-content a:active,[data-ea-type].loaded.adaptive .ea-content a:active{color:#f6f6f6}[data-ea-publisher].loaded.adaptive .ea-content a strong,[data-ea-publisher].loaded.adaptive .ea-content a b,[data-ea-type].loaded.adaptive .ea-content a strong,[data-ea-type].loaded.adaptive .ea-content a b{color:#50baf9}[data-ea-publisher].loaded.adaptive .ea-callout a:link,[data-ea-type].loaded.adaptive .ea-callout a:link{color:#c3c3c3}[data-ea-publisher].loaded.adaptive .ea-callout a:visited,[data-ea-type].loaded.adaptive .ea-callout a:visited{color:#c3c3c3}[data-ea-publisher].loaded.adaptive .ea-callout a:hover,[data-ea-type].loaded.adaptive .ea-callout a:hover{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-callout a:active,[data-ea-type].loaded.adaptive .ea-callout a:active{color:#dcdcdc}[data-ea-publisher].loaded.adaptive .ea-callout a strong,[data-ea-publisher].loaded.adaptive .ea-callout a b,[data-ea-type].loaded.adaptive .ea-callout a strong,[data-ea-type].loaded.adaptive .ea-callout a b{color:#50baf9}}[data-ea-publisher].loaded .ea-content,[data-ea-type].loaded .ea-content{border:0px;border-radius:3px;box-shadow:0px 2px 3px rgba(0,0,0,0.15)}[data-ea-publisher].loaded.raised .ea-content,[data-ea-type].loaded.raised .ea-content{border:0px;border-radius:3px;box-shadow:0px 2px 3px rgba(0,0,0,0.15)}[data-ea-publisher].loaded.bordered .ea-content,[data-ea-type].loaded.bordered .ea-content{border:1px solid rgba(0,0,0,0.04);border-radius:3px;box-shadow:none}[data-ea-publisher].loaded.bordered.dark .ea-content,[data-ea-type].loaded.bordered.dark .ea-content{border:1px solid rgba(255,255,255,0.07)}@media (prefers-color-scheme: dark){[data-ea-publisher].loaded.bordered.adaptive .ea-content,[data-ea-type].loaded.bordered.adaptive .ea-content{border:1px solid rgba(255,255,255,0.07)}}[data-ea-publisher].loaded.flat .ea-content,[data-ea-type].loaded.flat .ea-content{border:0px;border-radius:3px;box-shadow:none}[data-ea-type="image"].loaded,[data-ea-publisher]:not([data-ea-type]).loaded,.ea-type-image{display:inline-block}[data-ea-type="image"].loaded .ea-content,[data-ea-publisher]:not([data-ea-type]).loaded .ea-content,.ea-type-image .ea-content{max-width:180px;overflow:auto;text-align:center}[data-ea-type="image"].loaded .ea-content>a>img,[data-ea-publisher]:not([data-ea-type]).loaded .ea-content>a>img,.ea-type-image .ea-content>a>img{width:120px;height:90px;display:inline-block}[data-ea-type="image"].loaded .ea-content>.ea-text,[data-ea-publisher]:not([data-ea-type]).loaded .ea-content>.ea-text,.ea-type-image .ea-content>.ea-text{margin-top:1em;font-size:1em;text-align:center}[data-ea-type="image"].loaded .ea-callout,[data-ea-publisher]:not([data-ea-type]).loaded .ea-callout,.ea-type-image .ea-callout{max-width:180px;margin:0em 1em 1em 1em;padding-left:1em;padding-right:1em;font-style:italic;text-align:right}[data-ea-type="image"].loaded.horizontal .ea-content,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-content,.ea-type-image.horizontal .ea-content{max-width:320px}[data-ea-type="image"].loaded.horizontal .ea-content>a>img,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-content>a>img,.ea-type-image.horizontal .ea-content>a>img{float:left;margin-right:1em}[data-ea-type="image"].loaded.horizontal .ea-content .ea-text,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-content .ea-text,.ea-type-image.horizontal .ea-content .ea-text{margin-top:0em;text-align:left;overflow:auto}[data-ea-type="image"].loaded.horizontal .ea-callout,[data-ea-publisher]:not([data-ea-type]).loaded.horizontal .ea-callout,.ea-type-image.horizontal .ea-callout{max-width:320px;text-align:right}[data-ea-type="text"].loaded,.ea-type-text{font-size:14px}[data-ea-type="text"].loaded .ea-content,.ea-type-text .ea-content{text-align:left}[data-ea-type="text"].loaded .ea-callout,.ea-type-text .ea-callout{margin:0.5em 1em 1em 1em;padding-left:1em;padding-right:1em;text-align:right;font-style:italic}[data-ea-style="stickybox"].loaded{position:fixed;bottom:20px;right:20px;z-index:10}[data-ea-style="stickybox"].loaded .ea-type-image .ea-stickybox-hide{cursor:pointer;position:absolute;top:0.75em;right:0.75em;background-color:#fefefe;border:1px solid #088cdb;border-radius:50%;color:#088cdb;font-size:1em;text-align:center;height:1.5em;width:1.5em;line-height:1.5em}@media (max-width: 1300px){[data-ea-style="stickybox"].loaded{position:static;bottom:0;right:0;margin:auto;text-align:center}[data-ea-style="stickybox"].loaded .ea-stickybox-hide{display:none}}@media (min-width: 1301px){[data-ea-style="stickybox"].loaded .ea-type-image .ea-content{background:#dcdcdc}[data-ea-style="stickybox"].loaded.dark .ea-type-image .ea-content{background:#505050}}@media (min-width: 1301px) and (prefers-color-scheme: dark){[data-ea-style="stickybox"].loaded.adaptive .ea-type-image .ea-content{background:#505050}}[data-ea-style="fixedfooter"].loaded{position:fixed;bottom:0;left:0;z-index:10;width:100%;max-width:100%}[data-ea-style="fixedfooter"].loaded .ea-type-text{width:100%;max-width:100%;display:flex;z-index:10;background:#dcdcdc}[data-ea-style="fixedfooter"].loaded .ea-type-text .ea-content{border:0px;border-radius:3px;box-shadow:none}[data-ea-style="fixedfooter"].loaded .ea-type-text .ea-content{background-color:inherit;max-width:100%;margin:0;padding:1em;flex:auto}[data-ea-style="fixedfooter"].loaded .ea-type-text .ea-callout{max-width:100%;margin:0;padding:1em;flex:initial}@media (max-width: 576px){[data-ea-style="fixedfooter"].loaded .ea-type-text .ea-callout{display:none}}[data-ea-style="fixedfooter"].loaded .ea-type-text .ea-fixedfooter-hide{cursor:pointer;color:#505050;padding:1em;flex:initial;margin:auto 0}[data-ea-style="fixedfooter"].loaded .ea-type-text .ea-fixedfooter-hide span{padding:0.25em;font-size:0.8em;font-weight:bold;border:0.15em solid #505050;border-radius:0.5em;white-space:nowrap}[data-ea-style="fixedfooter"].loaded.dark .ea-type-text{background:#505050}[data-ea-style="fixedfooter"].loaded.dark .ea-type-text .ea-fixedfooter-hide span{color:#dcdcdc;border-color:#dcdcdc}@media (prefers-color-scheme: dark){[data-ea-style="fixedfooter"].loaded.adaptive .ea-type-text{background:#505050}[data-ea-style="fixedfooter"].loaded.adaptive .ea-type-text .ea-fixedfooter-hide span{color:#dcdcdc;border-color:#dcdcdc}}
</style><script src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/saved_resource" type="text/javascript" async=""></script></head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="https://arduino-esp8266.readthedocs.io/en/latest/index.html" class="icon icon-home"> ESP8266 Arduino Core
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://arduino-esp8266.readthedocs.io/en/latest/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
    <input type="hidden" name="check_keywords" value="yes">
    <input type="hidden" name="area" value="default">
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/ideoptions.html">Arduino IDE options</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/libraries.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/filesystem.html">File system</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/esp8266wifi/readme.html">ESP8266WiFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/ota_updates/readme.html">OTA Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/PROGMEM.html">PROGMEM</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/gdb.html">Using GDB to debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/mmu.html">MMU</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/boards.html">Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/readme.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/exception_causes.html">Exception causes</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/Troubleshooting/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/Troubleshooting/stack_dump.html">Stack Dump</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/eclipse/eclipse.html">Using with Eclipse</a></li>
</ul>

            
          
        </div>
      <div id="rtd-sidebar" data-ea-publisher="readthedocs" data-ea-type="readthedocs-sidebar" data-ea-manual="true" class="ethical-rtd ethical-dark-theme loaded" data-ea-keywords="arduino|c++|readthedocs-project-82240|readthedocs-project-arduino-esp8266" data-ea-campaign-types="community|house|paid"><div class="ethical-sidebar"><div class="ethical-content"><a href="https://server.ethicalads.io/proxy/click/1641/9ca2ea4c-d367-41bc-8e3e-6919dabfa733/" rel="nofollow noopener" target="_blank" class="ethical-image-link"><img src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/Screen_Shot_2021-08-03_at_2.45.09_PM.png" alt="Sponsored: EthicalAds"></a><div class="ethical-text"><a href="https://server.ethicalads.io/proxy/click/1641/9ca2ea4c-d367-41bc-8e3e-6919dabfa733/" rel="nofollow noopener" target="_blank"><strong class="ea-headline">Reach specific developers </strong><span class="ea-body">on the open source, privacy-first ad network:</span><strong class="ea-cta"> EthicalAds</strong></a></div></div><div class="ethical-callout"><small><em><a rel="nofollow noopener" target="_blank" href="https://www.ethicalads.io/?ref=rtd-sidebar">Ad by EthicalAds</a></em></small><span> &nbsp; · &nbsp; </span><a rel="nofollow noopener" target="_blank" href="https://www.ethicalads.io/advertisers/topics/security-privacy/?ref=rtd-sidebar-buy-ads">ℹ️</a></div></div><img src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/saved_resource(1)" class="ea-pixel"><img src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/saved_resource(2)" class="ea-pixel"></div></div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://arduino-esp8266.readthedocs.io/en/latest/index.html">ESP8266 Arduino Core</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="https://arduino-esp8266.readthedocs.io/en/latest/index.html">Docs</a> »</li>
        
      <li>My ESP crashes running some code. How to troubleshoot it?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/esp8266/Arduino/blob/master/doc/faq/a02-my-esp-crashes.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="my-esp-crashes-running-some-code-how-to-troubleshoot-it">
<h1>My ESP crashes running some code. How to troubleshoot it?<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#my-esp-crashes-running-some-code-how-to-troubleshoot-it" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#introduction">Introduction</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#what-esp-has-to-say">What ESP has to Say</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#get-your-hw-right">Get Your H/W Right</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#enable-compilation-warnings">Enable compilation warnings</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#what-is-the-cause-of-restart">What is the Cause of Restart?</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#exception">Exception</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#watchdog">Watchdog</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#exception-decoder">Exception Decoder</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#improving-exception-decoder-results">Improving Exception Decoder Results</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#other-causes-for-crashes">Other Common Causes for Crashes</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#if-at-the-wall-enter-an-issue-report">If at the Wall, Enter an Issue
Report</a></p></li>
<li><p><a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#conclusion">Conclusion</a></p></li>
</ul>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#introduction" title="Permalink to this heading">¶</a></h2>
<p>Your ESP is self restarting. You don’t know why and what to do about it.</p>
<p>Do not panic.</p>
<p>In most of cases ESP provides enough clues on serial monitor, that you
can interpret to pin down the root cause. The first step is then
checking what ESP is saying on serial monitor when it crashes.</p>
</div>
<div class="section" id="what-esp-has-to-say">
<h2>What ESP has to Say<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#what-esp-has-to-say" title="Permalink to this heading">¶</a></h2>
<p>Start off by opening a Serial Monitor (Ctrl+Shift+M) to observe the
output. Typical crash log looks as follows:</p>
<div class="figure align-default" id="id1">
<img alt="Typical crash log" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/a02-typical-crash-log.webp">
<p class="caption"><span class="caption-text">Typical crash log</span><a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#id1" title="Permalink to this image">¶</a></p>
</div>
<p>Before rushing to copy and paste displayed code to Google, reflect for a
while on the nature of observed restarts:</p>
<ul class="simple">
<li><p>Does ESP restart on random basis, or under certain conditions, like
serving a web page?</p></li>
<li><p>Do you see always the same exception code and stack trace or it
changes?</p></li>
<li><p>Does this issue occur with unmodified standard example code (Arduino
IDE &gt; <em>File &gt; Examples</em>)?</p></li>
</ul>
<p>If restarts are random or the exception code differs between restarts,
then the problem may be caused by h/w. If the issue occurs for standard
examples and stable <a class="reference external" href="https://github.com/esp8266/Arduino">esp8266 /
arduino</a> core, them the issue is
almost certainly caused by h/w.</p>
</div>
<div class="section" id="get-your-h-w-right">
<h2>Get Your H/W Right<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#get-your-h-w-right" title="Permalink to this heading">¶</a></h2>
<p>If you suspect the h/w, before troubleshooting the s/w, make sure to get
your h/w right. There is no much sense in diagnosing the s/w if you
board is randomly crashing because of not enough power, missing boot
strapping resistors or loose connections.</p>
<p>If you are using generic ESP modules, please follow
<a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/Generic%20ESP8266%20modules">recommendations</a> on power supply and
boot strapping resistors.</p>
<p>For boards with integrated USB-to-serial converter and power supply,
usually it is enough to connect it to an USB hub that provides standard
0.5A and is not shared with other USB devices.</p>
<p>In any case, make sure that your module is able to stably run standard
example sketches that establish Wi-Fi connection like, e.g.,
<a class="reference external" href="https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WebServer/examples/HelloServer">HelloServer.ino</a>.</p>
</div>
<div class="section" id="enable-compilation-warnings">
<h2>Enable compilation warnings<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#enable-compilation-warnings" title="Permalink to this heading">¶</a></h2>
<p>Most common issues may be resolved by enabling compilation warnings and fixing them.</p>
<p>For Arduino IDE, select <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Preferences</span></code>:</p>
<ul class="simple">
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">Show</span> <span class="pre">verbose</span> <span class="pre">output</span> <span class="pre">during:</span> <span class="pre">compilation</span></code> is enabled</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">Compiler</span> <span class="pre">warnings</span></code> to <code class="docutils literal notranslate"><span class="pre">More</span></code> or <code class="docutils literal notranslate"><span class="pre">All</span></code></p></li>
</ul>
<p>For PlatformIO, all warnings should already be enabled by default.</p>
<p>Notice that the default configuration of Arduino IDE inhibits <strong>all</strong> compilation warnings.
For the ESP8266 platform, some warnings should be treated as errors, otherwise it may cause unexpected issues at runtime:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">other</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">func</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Should fail to build with the following message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">return-value.cpp: In function ‘int func()’:</span>
<span class="go">return-value.cpp:2:1: error: no return statement in function returning non-void [-Werror=return-type]</span>
<span class="go">    2 | }</span>
<span class="go">      | ^</span>
<span class="go">compilation terminated due to -Wfatal-errors.</span>
<span class="go">cc1plus: some warnings being treated as errors</span>
</pre></div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">-Werror=return-type</span></code> is the default starting with Core 3.0.2 w/ GCC 10.3</p>
</div>
<div class="section" id="what-is-the-cause-of-restart">
<h2>What is the Cause of Restart?<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#what-is-the-cause-of-restart" title="Permalink to this heading">¶</a></h2>
<p>You have verified that the ESP h/w is healthy but it still restarts.
This is how ESP reacts to abnormal behavior of application. If something
is wrong, it restarts itself to tell you about it.</p>
<p>There are two typical scenarios that trigger ESP restarts:</p>
<ul class="simple">
<li><p><strong>Exception</strong> - when the code attempts an <a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/exception_causes.html"><span class="doc">illegal
operation</span></a>,
like trying to write to non-existent memory location.</p></li>
<li><p><strong>Watchdog</strong> - if the code <a class="reference external" href="https://en.wikipedia.org/wiki/Watchdog_timer">locks
up</a>, staying too long
in a loop or processing any other task without any pauses, which would
prevent vital processes like Wi-Fi communication from running.</p></li>
</ul>
<p>Please check below how to recognize <a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#exception">exception</a> and
<a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#watchdog">watchdog</a> scenarios and what to do about it.</p>
<div class="section" id="exception">
<h3>Exception<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#exception" title="Permalink to this heading">¶</a></h3>
<p>Typical restart because of exception looks like follows:</p>
<div class="figure align-default" id="id2">
<img alt="Exception cause decoding" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/a02-exception-cause-decoding.webp">
<p class="caption"><span class="caption-text">Exception cause decoding</span><a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Start with looking up exception code in the <a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/exception_causes.html"><span class="doc">Exception Causes
(EXCCAUSE)</span></a>
table to understand what kind of issue it is. If you have no clues what
it’s about and where it happens, then use <a class="reference external" href="https://github.com/me-no-dev/EspExceptionDecoder">Arduino ESP8266/ESP32
Exception Stack Trace
Decoder</a> to find
out in which line of application it is triggered. Please refer to <a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#check-where-the-code-crashes">Check
Where the Code Crashes</a> point below
for a quick example how to do it.</p>
<p><strong>NOTE:</strong> When decoding exceptions be sure to include all lines between
the <code class="docutils literal notranslate"><span class="pre">----</span> <span class="pre">CUT</span> <span class="pre">HERE</span> <span class="pre">----</span></code> marks in the output to allow the decoder to also
provide the line of code that’s actually causing the exception.</p>
</div>
<div class="section" id="watchdog">
<h3>Watchdog<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#watchdog" title="Permalink to this heading">¶</a></h3>
<p>ESP provides two watchdog timers (wdt) that observe application for lock
up.</p>
<ul class="simple">
<li><p><strong>Software Watchdog</strong> - provided by
<a class="reference external" href="https://bbs.espressif.com/viewforum.php?f=46">SDK</a>, that is part
of <a class="reference external" href="https://github.com/esp8266/Arduino">esp8266 / arduino</a> core
loaded to module together with your application.</p></li>
<li><p><strong>Hardware Watchdog</strong> - built-in ESP8266 hardware, acting if the
software watchdog is disabled for too long, in case it fails, or if
it is not provided at all.</p></li>
</ul>
<p>Restart by particular type of watchdog is clearly identified by ESP on
serial monitor.</p>
<p>An example of application crash triggered by software wdt is shown
below.</p>
<div class="figure align-default" id="id3">
<img alt="Example of restart by s/w watchdog" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/a02-sw-watchdog-example.webp">
<p class="caption"><span class="caption-text">Example of restart by s/w watchdog</span><a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#id3" title="Permalink to this image">¶</a></p>
</div>
<p>Restart by the software watchdog is generally easier to troubleshoot
since log includes the stack trace. The trace can be then used to find
particular line in code where wdt has been triggered.</p>
<p>Reset by hardware watchdog timer is shown on picture below.</p>
<div class="figure align-default" id="id4">
<img alt="Example of restart by h/w watchdog" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/a02-hw-watchdog-example.webp">
<p class="caption"><span class="caption-text">Example of restart by h/w watchdog</span><a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#id4" title="Permalink to this image">¶</a></p>
</div>
<p>Hardware wdt is the last resort of ESP to tell you that application is
locked up (if s/w wdt timer is disabled or not working).</p>
<p>Please note that for restarts initialized by h/w wdt, there is no stack
trace to help you identify the place in code where the lockup has
happened. In such case, to identify the place of lock up, you need to
rely on debug messages like <code class="docutils literal notranslate"><span class="pre">Serial.print</span></code> distributed across the
application. Then by observing what was the last debug message printed
out before restart, you should be able to narrow down part of code
firing the h/w wdt reset. If diagnosed application or library has debug
option then switch it on to aid this troubleshooting.</p>
</div>
</div>
<div class="section" id="exception-decoder">
<h2>Exception Decoder<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#exception-decoder" title="Permalink to this heading">¶</a></h2>
<p>Decoding of ESP stack trace is now easy and available to everybody
thanks to great <a class="reference external" href="https://github.com/me-no-dev/EspExceptionDecoder">Arduino ESP8266/ESP32 Exception Stack Trace
Decoder</a> developed
by @me-no-dev.</p>
<p>Installation for Arduino IDE is quick and easy following the
<a class="reference external" href="https://github.com/me-no-dev/EspExceptionDecoder#installation">installation</a>
instructions.</p>
<p>If you don’t have any code for troubleshooting, use the example below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">();</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"Let's provoke the s/w wdt firing..."</span><span class="p">);</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">provoke</span> <span class="n">an</span> <span class="n">OOM</span><span class="p">,</span> <span class="n">will</span> <span class="n">be</span> <span class="n">recorded</span> <span class="k">as</span> <span class="n">the</span> <span class="n">last</span> <span class="n">occurred</span> <span class="n">one</span>
  <span class="n">char</span><span class="o">*</span> <span class="n">out_of_memory_failure</span> <span class="o">=</span> <span class="p">(</span><span class="n">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">1000000</span><span class="p">);</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">s</span><span class="o">/</span><span class="n">w</span> <span class="n">wdt</span> <span class="ow">in</span> <span class="n">infinite</span> <span class="n">loop</span> <span class="n">below</span>
  <span class="k">while</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
  <span class="o">//</span>
  <span class="n">Serial</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"This line will not ever print out"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">loop</span><span class="p">(){}</span>
</pre></div>
</div>
<p>Enable the Out-Of-Memory (<em>OOM</em>) debug option (in the <em>Tools &gt; Debug Level</em>
menu), compile/flash/upload this code to your ESP (Ctrl+U) and start Serial
Monitor (Ctrl+Shift+M).  You should shortly see ESP restarting every couple
of seconds and <code class="docutils literal notranslate"><span class="pre">Soft</span> <span class="pre">WDT</span> <span class="pre">reset</span></code> message together with stack trace showing
up on each restart.  Click the Autoscroll check-box on Serial Monitor to
stop the messages scrolling up.  Select and copy the stack trace, including
the <code class="docutils literal notranslate"><span class="pre">last</span> <span class="pre">failed</span> <span class="pre">alloc</span> <span class="pre">call:</span> <span class="pre">...</span></code> line, go to the <em>Tools</em> and open the
<em>ESP Exception Decoder</em>.</p>
<div class="figure align-default" id="id5">
<img alt="Decode the stack trace, steps 1 and 2" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/a02-decode-stack-tace-1-2.webp">
<p class="caption"><span class="caption-text">Decode the stack trace, steps 1 and 2</span><a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#id5" title="Permalink to this image">¶</a></p>
</div>
<p>Now paste the stack trace to Exception Decoder’s window. At the bottom
of this window you should see a list of decoded lines of sketch you have
just uploaded to your ESP. On the top of the list, like on the top of
the stack trace, there is a reference to the last line executed just
before the software watchdog timer fired causing the ESP’s restart.
Check the number of this line and look it up on the sketch. It should be
the line <code class="docutils literal notranslate"><span class="pre">Serial.println("Let's</span> <span class="pre">provoke</span> <span class="pre">the</span> <span class="pre">s/w</span> <span class="pre">wdt</span> <span class="pre">firing...")</span></code>, that
happens to be just before <code class="docutils literal notranslate"><span class="pre">while(true)</span></code> that made the watchdog fired
(ignore the lines with comments, that are discarded by compiler).</p>
<div class="figure align-default" id="id6">
<img alt="Decode the stack trace, steps 3 through 6" src="./My ESP crashes running some code. How to troubleshoot it_ — ESP8266 Arduino Core 3.1.2-11-g57fa6cdc documentation_files/a02-decode-stack-tace-3-6.webp">
<p class="caption"><span class="caption-text">Decode the stack trace, steps 3 through 6</span><a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#id6" title="Permalink to this image">¶</a></p>
</div>
<p>Armed with <a class="reference external" href="https://github.com/me-no-dev/EspExceptionDecoder">Arduino ESP8266/ESP32 Exception Stack Trace
Decoder</a> you can
track down where the module is crashing whenever you see the stack trace
dropped. The same procedure applies to crashes caused by exceptions.</p>
<blockquote>
<div><p>Note, to decode the exact line of code where the application
crashed, you need to use ESP Exception Decoder in context of sketch
you have just loaded to the module for diagnosis. Decoder is not
able to correctly decode the stack trace dropped by some other
application not compiled and loaded from your Arduino IDE.</p>
</div></blockquote>
</div>
<div class="section" id="improving-exception-decoder-results">
<h2>Improving Exception Decoder Results<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#improving-exception-decoder-results" title="Permalink to this heading">¶</a></h2>
<p>Due to the limited resources on the device, our default compiler optimizations
focus on creating the smallest code size (<code class="docutils literal notranslate"><span class="pre">.bin</span></code> file). The GCC compiler’s
option <code class="docutils literal notranslate"><span class="pre">-Os</span></code> contains the base set of optimizations used. This set is fine for
release but not ideal for debugging.</p>
<p>Our view of a crash is often the <a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/Troubleshooting/stack_dump.html"><span class="doc">Stack Dump</span></a>
which gets copy/pasted into an Exception Decoder.
For some situations, the optimizer doesn’t write caller return addresses to the
stack. When we crash, the list of functions called is missing. And when the
crash occurs in a leaf function, there is seldom if ever any evidence of who
called.</p>
<p>With the <code class="docutils literal notranslate"><span class="pre">-Os</span></code> option, functions called once are inlined into the calling
function. A chain of these functions can optimize down to the calling function.
When the crash occurs in one of these chain functions, the actual location in
the source code is no longer available.</p>
<p>When you select <code class="docutils literal notranslate"><span class="pre">Debug</span> <span class="pre">Optimization:</span> <span class="pre">Lite</span></code> on the Arduino IDE Tools menu, it
turns off <code class="docutils literal notranslate"><span class="pre">optimize-sibling-calls</span></code>. Turning off this optimization allows more
caller addresses to be written to the stack, improving the results from the
Exception Decoder. Without this option, the callers involved in the crash may be
missing from the Decoder results. Because of the limited stack space, there is
the remote possibility that removing this optimization could lead to more
frequent stack overflows. You only want to do this in a debug setting. This
option does not help the chained function issue.</p>
<p>When you select <code class="docutils literal notranslate"><span class="pre">Debug</span> <span class="pre">Optimization:</span> <span class="pre">Optimum</span></code>, you get an even more complete
stack trace. For example, chained function calls may show up. This selection
uses the compiler option <code class="docutils literal notranslate"><span class="pre">-Og</span></code>. GCC considers this the ideal optimization for
the “edit-compile-debug cycle” … “producing debuggable code.” You can read the
specifics at <a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html">GCC’s Optimize Options</a></p>
<p>When global optimization creates build size issues or stack overflow issues,
select <code class="docutils literal notranslate"><span class="pre">Debug</span> <span class="pre">Optimization:</span> <span class="pre">None</span></code>, and use a targeted approach with
<code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">GCC</span> <span class="pre">optimize("Og")</span></code> at the module level. Or, if you want to use a
different set of optimizations, you can set optimizations through build options.
Read more at <a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a06-global-build-options.html"><span class="doc">Global Build Options</span></a>.</p>
<p>For non-Arduino IDE build platforms, you may need to research how to add build
options. Some build platforms already use <code class="docutils literal notranslate"><span class="pre">-Og</span></code> for debug builds.</p>
<p>A crash in a leaf function may not leave the caller’s address on the stack.
The return address can stay in a register for the duration of the call.
Resulting in a crash report identifying the crashing function without a
trace of who called. You can encourage the compiler to save the caller’s
return address by adding an inline assembly trick
<code class="docutils literal notranslate"><span class="pre">__asm__</span> <span class="pre">__volatile__(""</span> <span class="pre">:::</span> <span class="pre">"a0",</span> <span class="pre">"memory");</span></code> at the beginning of the
function’s body. Or instead, for a debug build conditional option, use the
macro <code class="docutils literal notranslate"><span class="pre">DEBUG_LEAF_FUNCTION()</span></code> from <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;debug.h&gt;</span></code>. For compiler
toolchain 3.2.0 and above, the <code class="docutils literal notranslate"><span class="pre">-Og</span></code> option is an alternative solution.</p>
<p>In some cases, adding <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">GCC</span> <span class="pre">optimize("Og,no-ipa-pure-const")</span></code> to a
module as well as using <code class="docutils literal notranslate"><span class="pre">DEBUG_LEAF_FUNCTION()</span></code> in a leaf function were
needed to display a complete call chain. Or use
<code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">GCC</span> <span class="pre">optimize("Os,no-inline,no-optimize-sibling-calls,no-ipa-pure-const")</span></code>
if you require optimization <code class="docutils literal notranslate"><span class="pre">-Os</span></code>.</p>
</div>
<div class="section" id="other-causes-for-crashes">
<h2>Other Causes for Crashes<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#other-causes-for-crashes" title="Permalink to this heading">¶</a></h2>
<dl>
<dt>Interrupt Service Routines</dt><dd><p>By default, all functions are compiled into flash, which means that the
cache may kick in for that code. However, the cache currently can’t be used
during hardware interrupts. That means that, if you use a hardware ISR, such as
attachInterrupt(gpio, myISR, CHANGE) for a GPIO change, the ISR must have the
IRAM_ATTR attribute declared. Not only that, but the entire function tree
called from the ISR must also have the IRAM_ATTR declared.
Be aware that every function that has this attribute reduces available memory.</p>
<p>In addition, it is not possible to execute delay() or yield() from an ISR,
or do blocking operations, or operations that disable the interrupts, e.g.: read
a DHT.</p>
<p>Finally, an ISR has very high restrictions on timing for the executed code, meaning
that executed code should not take longer than a very few microseconds. It is
considered best practice to set a flag within the ISR, and then from within the loop()
check and clear that flag, and execute code.</p>
</dd>
<dt>Asynchronous Callbacks</dt><dd><p>Asynchronous CBs, such as for the Ticker or ESPAsync* libs, have looser restrictions
than ISRs, but some restrictions still apply.
It is not possible to execute delay() or yield() from an asynchronous callback.
Timing is not as tight as an ISR, but it should remain below a few milliseconds. This
is a guideline. The hard timing requirements depend on the WiFi configuration and
amount of traffic. In general, the CPU must not be hogged by the user code, as the
longer it is away from servicing the WiFi stack, the more likely that memory corruption
can happen.</p>
</dd>
<dt>Memory, memory, memory</dt><dd><p>Running out of heap is the <strong>most common cause for crashes</strong>. Because the build process for
the ESP leaves out exceptions (they use memory), memory allocations that fail will do
so silently. A typical example is when setting or concatenating a large String. If
allocation has failed internally, then the internal string copy can corrupt data, and
the ESP will crash.</p>
<p>In addition, doing many String concatenations in sequence, e.g.: using operator+()
multiple times, will cause memory fragmentation. When that happens, allocations may
silently fail even though there is enough total heap available. The reason for the
failure is that an allocation requires finding a single free memory block that is large
enough for the size being requested. A sequence of String concatenations causes many
allocations/deallocations/reallocations, which makes “holes” in the memory map. After
many such operations, it can happen that all available holes are too small to comply
with the requested size, even though the sum of all holes is greater than the requested
size.</p>
<p>So why do these silent failures exist? On the one hand, there are specific interfaces that
must be adhered to. For example, the String object methods don’t allow for error handling
at the user application level (i.e.: no old-school error returns).
On the other hand, some libraries don’t have the allocation code accessible for
modification. For example, std::vector is available for use. The standard implementations
rely on exceptions for error handling, which is not available for the ESP, and in any
case there is no access to the underlying code.</p>
<p>Instrumenting the code with the OOM debug option and calls to
<code class="docutils literal notranslate"><span class="pre">ESP.getFreeHeap()</span></code> / <code class="docutils literal notranslate"><span class="pre">ESP.getHeapFragmentation()</span></code> /
<code class="docutils literal notranslate"><span class="pre">ESP.getMaxFreeBlockSize()</span></code> will help the process of finding memory issues.</p>
<p>Now is time to re-read about the <a class="reference external" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#exception-decoder">exception decoder</a>.</p>
</dd>
</dl>
<p><em>Some techniques for reducing memory usage</em></p>
<blockquote>
<div><ul class="simple">
<li><p>Don’t use const char * with literals. Instead, use const char[] PROGMEM. This is particularly true if you intend to, e.g.: embed html strings.</p></li>
<li><p>Don’t use global static arrays, such as uint8_t buffer[1024]. Instead, allocate dynamically. This forces you to think about the size of the array, and its scope (lifetime), so that it gets released when it’s no longer needed. If you are not certain about dynamic allocation, use std libs (e.g.: std:vector, std::string), or smart pointers. They are slightly less memory efficient than dynamically allocating yourself, but the provided memory safety is well worth it.</p></li>
<li><p>If you use std libs like std::vector, make sure to call its ::reserve() method before filling it. This allows allocating only once, which reduces mem fragmentation, and makes sure that there are no empty unused slots left over in the container at the end.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Stack</dt><dd><p>The amount of stack in the ESP is tiny at only 4KB. For normal development in large systems, it
is good practice to use and abuse the stack, because it is faster for allocation/deallocation, the scope of the object is well defined, and deallocation automatically happens in reverse order as allocation, which means no mem fragmentation. However, with the tiny amount of stack available in the ESP, that practice is not really viable, at least not for big objects.</p>
<ul class="simple">
<li><p>Large objects that have internally managed memory, such as String, std::string, std::vector, etc, are ok on the stack, because they internally allocate their buffers on the heap.</p></li>
<li><p>Large arrays on the stack, such as uint8_t buffer[2048] should be avoided on the stack and should be dynamically allocated instead (consider smart pointers).</p></li>
<li><p>Objects that have large data members, such as large arrays, should also be avoided on the stack, and should be dynamically allocated (consider smart pointers).</p></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="if-at-the-wall-enter-an-issue-report">
<h2>If at the Wall, Enter an Issue Report<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#if-at-the-wall-enter-an-issue-report" title="Permalink to this heading">¶</a></h2>
<p>Using the procedure above you should be able to troubleshoot all the
code you write. It may happen that ESP is crashing inside some library
or code you are not familiar enough to troubleshoot. If this is the case
then contact the application author by writing an issue report.</p>
<p>Follow the guidelines on issue reporting that may be provided by the
author of code in his / her repository.</p>
<p>If there are no guidelines, include in your report the following:</p>
<ul class="simple">
<li><p>[ ] Exact step-by-step instructions to reproduce the issue</p></li>
<li><p>[ ] Your exact hardware configuration including the schematic</p></li>
<li><p>[ ] If the issue concerns a standard, commercially available ESP board
with power supply and USB interface, without extra h/w attached, then
provide just the board type or a link to its description</p></li>
<li><p>[ ] Configuration settings in Arduino IDE used to upload the
application</p></li>
<li><p>[ ] Error log &amp; messages produced by the application (enable
debugging for more details)</p></li>
<li><p>[ ] Decoded stack trace</p></li>
<li><p>[ ] Copy of your sketch</p></li>
<li><p>[ ] Copy of all the libraries used by the sketch (if you are using
standard libraries available in the Arduino Library Manager,
then provide just version numbers)</p></li>
<li><p>[ ] Version of <a class="reference external" href="https://github.com/esp8266/Arduino">esp8266 /
Arduino</a> core</p></li>
<li><p>[ ] Name and version of your programming IDE and O/S</p></li>
</ul>
<p>With plenty of ESP module types available, several versions of libraries
or <a class="reference external" href="https://github.com/esp8266/Arduino">esp8266 / Arduino</a> core,
types and versions of O/S, you need to provide exact information on what
your application is about. Only then, people willing to look into your
issue may be able to compare it to a configuration they are familiar with.
If you are lucky, they may even attempt to reproduce your issue on their
own equipment!
This will be far more difficult if you provide only vague details,
so somebody would need to ask you to find out what is really happening.</p>
<p>On the other hand, if you flood your issue report with hundreds lines of
code, you may also have difficulty finding somebody willing to analyze
it. Therefore, reduce your code to the bare minimum that is still causing
the issue. This will also help to isolate the issue and pin down
the root cause.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html#conclusion" title="Permalink to this heading">¶</a></h2>
<p>Do not be afraid to troubleshoot ESP exception and watchdog restarts.
<a class="reference external" href="https://github.com/esp8266/Arduino">Esp8266 / Arduino</a> core provides
detailed diagnostics that will help you pin down the issue. Before
checking the s/w, get your h/w right. Use <a class="reference external" href="https://github.com/me-no-dev/EspExceptionDecoder">ESP Exception
Decoder</a> to find
out where the code fails. If you do you homework and are still unable to
identify the root cause, submit an issue report. Provide enough details.
Be specific and isolate the issue. Then ask community for support. There
are plenty of people that like to work with ESP and willing to help with
your problem.</p>
<p><a class="reference internal" href="https://arduino-esp8266.readthedocs.io/en/latest/faq/readme.html"><span class="doc">FAQ list :back:</span></a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr>

  <div role="contentinfo">
    <p>
        © Copyright 2017, Ivan Grokhotkov
      
        <span class="commit">
          Revision <code>57fa6cdc</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions"><!-- Inserted RTD Footer -->

<div class="injected">

  

      
      
      
      <dl>
        <dt>Versions</dt>
        
        <dd class="rtd-current-item">
          <a href="https://arduino-esp8266.readthedocs.io/en/latest/faq/a02-my-esp-crashes.html">latest</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/stable/faq/a02-my-esp-crashes.html">stable</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/3.1.2/faq/a02-my-esp-crashes.html">3.1.2</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/3.1.1/faq/a02-my-esp-crashes.html">3.1.1</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/3.1.0/faq/a02-my-esp-crashes.html">3.1.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/3.0.2/faq/a02-my-esp-crashes.html">3.0.2</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/3.0.1/faq/a02-my-esp-crashes.html">3.0.1</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/3.0.0/faq/a02-my-esp-crashes.html">3.0.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.7.4_a/faq/a02-my-esp-crashes.html">2.7.4</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.7.3_a/faq/a02-my-esp-crashes.html">2.7.3</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.7.2/faq/a02-my-esp-crashes.html">2.7.2</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.7.1/faq/a02-my-esp-crashes.html">2.7.1</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.7.0/faq/a02-my-esp-crashes.html">2.7.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.6.3/faq/a02-my-esp-crashes.html">2.6.3</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.6.2/faq/a02-my-esp-crashes.html">2.6.2</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.6.1/faq/a02-my-esp-crashes.html">2.6.1</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.6.0/faq/a02-my-esp-crashes.html">2.6.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.5.2/faq/a02-my-esp-crashes.html">2.5.2</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.5.1/faq/a02-my-esp-crashes.html">2.5.1</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.5.0/faq/a02-my-esp-crashes.html">2.5.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.4.2/faq/a02-my-esp-crashes.html">2.4.2</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.4.1/faq/a02-my-esp-crashes.html">2.4.1</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.4.0/faq/a02-my-esp-crashes.html">2.4.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.3.0/faq/a02-my-esp-crashes.html">2.3.0</a>
        </dd>
        
        <dd>
          <a href="https://arduino-esp8266.readthedocs.io/en/2.2.0/faq/a02-my-esp-crashes.html">2.2.0</a>
        </dd>
        
      </dl>
      
      

      
      
      <dl>
        <dt>Downloads</dt>
        
        <dd><a href="https://arduino-esp8266.readthedocs.io/_/downloads/en/latest/pdf/">PDF</a></dd>
        
        <dd><a href="https://arduino-esp8266.readthedocs.io/_/downloads/en/latest/htmlzip/">HTML</a></dd>
        
        <dd><a href="https://arduino-esp8266.readthedocs.io/_/downloads/en/latest/epub/">Epub</a></dd>
        
      </dl>
      
      

      
      <dl>
        
        <!-- These are kept as relative links for internal installs that are http -->
        <dt>On Read the Docs</dt>
        <dd>
          <a href="https://readthedocs.org/projects/arduino-esp8266/">Project Home</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/arduino-esp8266/builds/">Builds</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/arduino-esp8266/downloads/">Downloads</a>
        </dd>
      </dl>
      

      

      
      <dl>
        <dt>On GitHub</dt>
        <dd>
          <a href="https://github.com/esp8266/Arduino/blob/master/doc/faq/a02-my-esp-crashes.rst">View</a>
        </dd>
        
        <dd>
          <a href="https://github.com/esp8266/Arduino/edit/master/doc/faq/a02-my-esp-crashes.rst">Edit</a>
        </dd>
        
      </dl>
      
      

      
      <dl>
        <dt>Search</dt>
        <dd>
          <div style="padding: 6px;">
            
            <form id="flyout-search-form" class="wy-form" target="_blank" action="https://readthedocs.org/projects/arduino-esp8266/search/" method="get">
              <input type="text" name="q" aria-label="Search docs" placeholder="Search docs">
              </form>
          </div>
        </dd>
      </dl>
      

      <hr>

      
        <small>
          <span>Hosted by <a href="https://readthedocs.org/">Read the Docs</a></span>
          <span> · </span>
          <a href="https://docs.readthedocs.io/page/privacy-policy.html">Privacy Policy</a>
        </small>
      

      

</div>
</div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   


</body></html>